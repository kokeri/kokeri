<!doctype html><html><head><title>mKCP :: Project X</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-02-09T14:04:28 UTC"><meta name=description content="Project X 的文档."><meta name=author content="Project X"><title>mKCP :: Project X</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/layout.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.main.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.menu.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/notice.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/tabs.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/panel.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/columns.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/children.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/attachments.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/alert.css><link rel=stylesheet type=text/css href=/css/docport.css><script src=/js/docport.js></script><script type=text/javascript>var baseurl="https:\/\/xtls.github.io";</script><link rel=stylesheet href=/css/custom.css></head><body data-url=/config/transports/mkcp/><style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style><header><div><div class=burger><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a></div><div><a class=baselink href=https://xtls.github.io>Project X</a></div><nav class=shortcuts><li role><a href=/about/new rel=noopener>What's New</a></li><li role><a href=https://github.com/XTLS rel=noopener>GitHub</a></li><li role><a href=https://github.com/XTLS/Xray-core/releases rel=noopener>Download</a></li><li role><a href=https://xtls.github.io/ rel=noopener>Documentation</a></li></nav></div></header><article><aside><div class=search><div class=searchbox><input data-search-input id=search-by type=text placeholder></div><script type=text/javascript src=/vendor/lunr/lunr.min.js></script><script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script><link href=/vendor/auto-complete/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https:\/\/xtls.github.io";</script><script type=text/javascript src=/js/search.js></script></div><center><a class=github-button href=https://github.com/XTLS/Xray-core/releases data-icon=octicon-cloud-download aria-label="Download vjeantet/hugo-theme-docport on GitHub">Download</a>
<a class=github-button href=https://github.com/XTLS/Xray-core data-icon=octicon-star data-show-count=false aria-label="Star vjeantet/hugo-theme-docport on GitHub">Star</a>
<a class=github-button href=https://github.com/XTLS/Xray-core/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork vjeantet/hugo-theme-docport on GitHub">Fork</a></center>
<script async defer src=https://buttons.github.io/buttons.js></script><div id=close_menu><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')"><i class="fa fa-lg fa-times"></i></a></div><ul class=menu><hr><li data-nav-id=https://xtls.github.io/about/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/about/>Project X&nbsp;⚡</a><ul><li data-nav-id=https://xtls.github.io/about/new/ class="dd-item
item_level_$level"><a href=/about/new/>大史记&nbsp;</a></li></ul></li><hr><li data-nav-id=https://xtls.github.io/guide/ class="dd-item alwaysopen
item_level_$level"><a href=/guide/>快速入门&nbsp;</a></li><li data-nav-id=https://xtls.github.io/config/ class="dd-item parent haschildren
item_level_$level"><i class="fas fa-chevron-down ddexp"></i><a href=/config/>配置文件&nbsp;📜</a><ul><li data-nav-id=https://xtls.github.io/config/base/ class="dd-item haschildren
item_level_$level"><a href=/config/base/>基础配置模块&nbsp;</a>
<i class="fas fa-chevron-right ddexp"></i><ul><li data-nav-id=https://xtls.github.io/config/base/log/ class="dd-item
item_level_$level"><a href=/config/base/log/>日志配置</a></li><li data-nav-id=https://xtls.github.io/config/base/api/ class="dd-item
item_level_$level"><a href=/config/base/api/>API接口</a></li><li data-nav-id=https://xtls.github.io/config/base/dns/ class="dd-item
item_level_$level"><a href=/config/base/dns/>内置DNS服务器</a></li><li data-nav-id=https://xtls.github.io/config/base/routing/ class="dd-item
item_level_$level"><a href=/config/base/routing/>路由</a></li><li data-nav-id=https://xtls.github.io/config/base/policy/ class="dd-item
item_level_$level"><a href=/config/base/policy/>本地策略</a></li><li data-nav-id=https://xtls.github.io/config/base/inbounds/ class="dd-item
item_level_$level"><a href=/config/base/inbounds/>Inbounds</a></li><li data-nav-id=https://xtls.github.io/config/base/outbounds/ class="dd-item
item_level_$level"><a href=/config/base/outbounds/>Outbounds</a></li><li data-nav-id=https://xtls.github.io/config/base/transport/ class="dd-item
item_level_$level"><a href=/config/base/transport/>传输方式</a></li><li data-nav-id=https://xtls.github.io/config/base/stats/ class="dd-item
item_level_$level"><a href=/config/base/stats/>统计信息</a></li><li data-nav-id=https://xtls.github.io/config/base/reverse/ class="dd-item
item_level_$level"><a href=/config/base/reverse/>反向代理</a></li></ul></li><li data-nav-id=https://xtls.github.io/config/inbound-protocols/ class="dd-item
item_level_$level"><a href=/config/inbound-protocols/>Inbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/config/outbound-protocols/ class="dd-item
item_level_$level"><a href=/config/outbound-protocols/>Outbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/config/transports/ class="dd-item parent active
item_level_$level"><a href=/config/transports/>传输方式列表</a></li><li data-nav-id=https://xtls.github.io/config/vless/ class="dd-item
item_level_$level"><a href=/config/vless/>VLESS 协议详解</a></li><li data-nav-id=https://xtls.github.io/config/fallback/ class="dd-item
item_level_$level"><a href=/config/fallback/>Fallbacks</a></li><li data-nav-id=https://xtls.github.io/config/xtls/ class="dd-item
item_level_$level"><a href=/config/xtls/>XTLS 深度剖析</a></li><li data-nav-id=https://xtls.github.io/config/env/ class="dd-item
item_level_$level"><a href=/config/env/>环境变量</a></li><li data-nav-id=https://xtls.github.io/config/multiple_config/ class="dd-item alwaysopen
item_level_$level"><a href=/config/multiple_config/>多文件配置</a></li></ul></li><li data-nav-id=https://xtls.github.io/documents/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/documents/>使用心得&nbsp;📚</a><ul><li data-nav-id=https://xtls.github.io/documents/level-0/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-0/>小小白白话文&nbsp;📙</a></li><li data-nav-id=https://xtls.github.io/documents/level-1/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-1/>入门技巧&nbsp;📚</a></li><li data-nav-id=https://xtls.github.io/documents/level-2/ class="dd-item alwaysopen
item_level_$level"><a href=/documents/level-2/>进阶文档&nbsp;📘</a></li></ul></li><li data-nav-id=https://xtls.github.io/develop/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/develop/>开发指南&nbsp;🖥️</a><ul><li data-nav-id=https://xtls.github.io/develop/intro/ class="dd-item alwaysopen
item_level_$level"><a href=/develop/intro/>开发手册</a></li><li data-nav-id=https://xtls.github.io/develop/protocols/ class="dd-item alwaysopen
item_level_$level"><a href=/develop/protocols/>协议详解</a></li></ul></li><li data-nav-id=https://xtls.github.io/faq/ class="dd-item alwaysopen
item_level_$level"><a href=/faq/>常见问答&nbsp;💬</a></li><li data-nav-id=https://xtls.github.io/caseslip/ class="dd-item alwaysopen
item_level_$level"><a href=/caseslip/>大案牍术&nbsp;</a></li><hr><li data-nav-id=https://xtls.github.io/links/ class="dd-item alwaysopen
item_level_$level"><a href=/links/>常用链接&nbsp;🤝</a></li></ul></aside><section class=page><nav id=ariane aria-label=breadcrumb><ol class=ariane><li><a class=text-link href=https://xtls.github.io></a></li><li><a class=text-link href=/config/>配置文件</a></li><li><a class=text-link href=/config/transports/>传输方式列表</a></li><li class=active>mKCP</li></ol></nav><h1>传输方式列表<span>mKCP</span></h1><nav class=subpages><li><a title=$pagetitle href=/config/transports/tcp/>TCP</a></li><li><a title=$pagetitle href=/config/transports/websocket/>WebSocket</a></li><li><a title=$pagetitle href=/config/transports/domainsocket/>Domain Socket</a></li><li class=active><a title=$pagetitle href=/config/transports/mkcp/>mKCP</a></li><li><a title=$pagetitle href=/config/transports/h2/>HTTP/2</a></li><li><a title=$pagetitle href=/config/transports/quic/>QUIC</a></li></nav><div class=jump-to-section><span onclick="$h=$(this);$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><span class="fas fa-align-right"></span><i class="fas fa-chevron-right"></i></span><nav id=TableOfContents><ul><li><a href=#kcpobject>KcpObject</a><ul><li><a href=#headerobject>HeaderObject</a></li></ul></li><li><a href=#鸣谢>鸣谢</a></li><li><a href=#对-kcp-协议的改进>对 KCP 协议的改进</a><ul><li><a href=#更小的协议头>更小的协议头</a></li><li><a href=#确认包重传>确认包重传</a></li><li><a href=#连接状态控制>连接状态控制</a></li></ul></li></ul></nav></div><div class=content><p>mKCP 使用 UDP 来模拟 TCP 连接。</p><p>mKCP 牺牲带宽来降低延迟。传输同样的内容，mKCP 一般比 TCP 消耗更多的流量。</p><div class="notices info"><p><strong>TIP</strong><br>请确定主机上的防火墙配置正确</p></div><h2 ref=kcpobject>KcpObject</h2><a class=anchor id=kcpobject></a><hr><p><code>KcpObject</code> 对应传输配置的 <code>kcpSettings</code> 项。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;mtu&#34;</span>: <span style=color:#ae81ff>1350</span>,
  <span style=color:#f92672>&#34;tti&#34;</span>: <span style=color:#ae81ff>20</span>,
  <span style=color:#f92672>&#34;uplinkCapacity&#34;</span>: <span style=color:#ae81ff>5</span>,
  <span style=color:#f92672>&#34;downlinkCapacity&#34;</span>: <span style=color:#ae81ff>20</span>,
  <span style=color:#f92672>&#34;congestion&#34;</span>: <span style=color:#66d9ef>false</span>,
  <span style=color:#f92672>&#34;readBufferSize&#34;</span>: <span style=color:#ae81ff>1</span>,
  <span style=color:#f92672>&#34;writeBufferSize&#34;</span>: <span style=color:#ae81ff>1</span>,
  <span style=color:#f92672>&#34;header&#34;</span>: {
    <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>
  },
  <span style=color:#f92672>&#34;seed&#34;</span>: <span style=color:#e6db74>&#34;Password&#34;</span>
}
</code></pre></div><div class="notices dark"><p><code>mtu</code>: number</p></div><p>最大传输单元（maximum transmission unit）<br>请选择一个介于 <code>576</code> - <code>1460</code> 之间的值。</p><p>默认值为 <code>1350</code>。</p><div class="notices dark"><p><code>tti</code>: number</p></div><p>传输时间间隔（transmission time interval），单位毫秒（ms），mKCP 将以这个时间频率发送数据。<br>请选译一个介于 <code>10</code> - <code>100</code> 之间的值。</p><p>默认值为 <code>50</code>。</p><div class="notices dark"><p><code>uplinkCapacity</code>: number</p></div><p>上行链路容量，即主机发出数据所用的最大带宽，单位 MB/s，注意是 Byte 而非 bit。<br>可以设置为 <code>0</code>，表示一个非常小的带宽。</p><p>默认值 <code>5</code>。</p><div class="notices dark"><p><code>downlinkCapacity</code>: number</p></div><p>下行链路容量，即主机接收数据所用的最大带宽，单位 MB/s，注意是 Byte 而非 bit。<br>可以设置为 <code>0</code>，表示一个非常小的带宽。</p><p>默认值 <code>20</code>。</p><div class="notices info"><p><strong>TIP</strong><br><code>uplinkCapacity</code> 和 <code>downlinkCapacity</code> 决定了 mKCP 的传输速度。<br>以客户端发送数据为例，客户端的 <code>uplinkCapacity</code> 指定了发送数据的速度，而服务器端的 <code>downlinkCapacity</code> 指定了接收数据的速度。两者的值以较小的一个为准。<br></p><p>推荐把 <code>downlinkCapacity</code> 设置为一个较大的值，比如 100，而 <code>uplinkCapacity</code> 设为实际的网络速度。当速度不够时，可以逐渐增加 <code>uplinkCapacity</code> 的值，直到带宽的两倍左右。</p></div><div class="notices dark"><p><code>congestion</code>: true | false</p></div><p>是否启用拥塞控制。</p><p>开启拥塞控制之后，Xray 会自动监测网络质量，当丢包严重时，会自动降低吞吐量；当网络畅通时，也会适当增加吞吐量。</p><p>默认值为 <code>false</code></p><div class="notices dark"><p><code>readBufferSize</code>: number</p></div><p>单个连接的读取缓冲区大小，单位是 MB。</p><p>默认值为 <code>2</code>。</p><div class="notices dark"><p><code>writeBufferSize</code>: number</p></div><p>单个连接的写入缓冲区大小，单位是 MB。</p><p>默认值为 <code>2</code>。</p><div class="notices info"><p><strong>TIP</strong><br><code>readBufferSize</code> 和 <code>writeBufferSize</code> 指定了单个连接所使用的内存大小。<br>在需要高速传输时，指定较大的 <code>readBufferSize</code> 和 <code>writeBufferSize</code> 会在一定程度上提高速度，但也会使用更多的内存。<br></p><p>在网速不超过 20MB/s 时，默认值 1MB 可以满足需求；超过之后，可以适当增加 <code>readBufferSize</code> 和 <code>writeBufferSize</code> 的值，然后手动平衡速度和内存的关系。</p></div><div class="notices dark"><p><code>header</code>: <a href=#headerobject>HeaderObject</a></p></div><p>数据包头部伪装设置</p><div class="notices dark"><p><code>seed</code>: string</p></div><p>可选的混淆密码，使用 AES-128-GCM 算法混淆流量数据，客户端和服务端需要保持一致。</p><p>本混淆机制不能用于保证通信内容的安全，但可能可以对抗部分封锁。<div class="notices info"><p><strong>TIP</strong><br>目前测试环境下开启此设置后没有出现原版未混淆版本的封端口现象</p></div></p><p><br></p><h3 ref=headerobject>HeaderObject</h3><a class=anchor id=headerobject></a><hr><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;none&#34;</span>
}
</code></pre></div><div class="notices dark"><p><code>type</code>: string</p></div><p>伪装类型，可选的值有：</p><ul><li><code>"none"</code>：默认值，不进行伪装，发送的数据是没有特征的数据包。</li><li><code>"srtp"</code>：伪装成 SRTP 数据包，会被识别为视频通话数据（如 FaceTime）。</li><li><code>"utp"</code>：伪装成 uTP 数据包，会被识别为 BT 下载数据。</li><li><code>"wechat-video"</code>：伪装成微信视频通话的数据包。</li><li><code>"dtls"</code>：伪装成 DTLS 1.2 数据包。</li><li><code>"wireguard"</code>：伪装成 WireGuard 数据包。（并不是真正的 WireGuard 协议）</li></ul><p><br></p><h2 ref=鸣谢>鸣谢</h2><a class=anchor id=鸣谢></a><hr><ul><li><a href=https://github.com/skywind3000>@skywind3000</a> 发明并实现了 KCP 协议。</li><li><a href=https://github.com/xtaci>@xtaci</a> 将 KCP 由 C 语言实现翻译成 Go。</li><li><a href=https://github.com/xiaokangwang>@xiaokangwang</a> 测试 KCP 与 Xray 的整合并提交了最初的 PR。</li></ul><p><br></p><h2 ref=对-kcp-协议的改进>对 KCP 协议的改进</h2><a class=anchor id=对-kcp-协议的改进></a><hr><h3 ref=更小的协议头>更小的协议头</h3><a class=anchor id=更小的协议头></a><hr><p>原生 KCP 协议使用了 24 字节的固定头部，而 mKCP 修改为数据包 18 字节，确认（ACK）包 16 字节。更小的头部有助于躲避特征检查，并加快传输速度。</p><p>另外，原生 KCP 的单个确认包只能确认一个数据包已收到，也就是说当 KCP 需要确认 100 个数据已收到时，它会发出 24 * 100 = 2400 字节的数据。其中包含了大量重复的头部数据，造成带宽的浪费。mKCP 会对多个确认包进行压缩，100 个确认包只需要 16 + 2 + 100 * 4 = 418 字节，相当于原生的六分之一。</p><h3 ref=确认包重传>确认包重传</h3><a class=anchor id=确认包重传></a><hr><p>原生 KCP 协议的确认（ACK）包只发送一次，如果确认包丢失，则一定会导致数据重传，造成不必要的带宽浪费。而 mKCP 会以一定的频率重发确认包，直到发送方确认为止。单个确认包的大小为 22 字节，相比起数据包的 1000 字节以上，重传确认包的代价要小得多。</p><h3 ref=连接状态控制>连接状态控制</h3><a class=anchor id=连接状态控制></a><hr><p>mKCP 可以有效地开启和关闭连接。当远程主机主动关闭连接时，连接会在两秒钟之内释放；当远程主机断线时，连接会在最多 30 秒内释放。</p><p>原生 KCP 不支持这个场景。</p></div><div class=chevrons></div></section><section class=right-menu><div class=TableOfContents><label><i class="fas fa-align-right"></i>&nbsp;&nbsp;</label><nav><ul><li><a href=/config/transports/mkcp/>mKCP</a></li></ul></nav><nav id=TableOfContents><ul><li><a href=#kcpobject>KcpObject</a><ul><li><a href=#headerobject>HeaderObject</a></li></ul></li><li><a href=#鸣谢>鸣谢</a></li><li><a href=#对-kcp-协议的改进>对 KCP 协议的改进</a><ul><li><a href=#更小的协议头>更小的协议头</a></li><li><a href=#确认包重传>确认包重传</a></li><li><a href=#连接状态控制>连接状态控制</a></li></ul></li></ul></nav></div><div class=Actions><nav><ul><li><a href=https://github.com/XTLS/XTLS.github.io/tree/main/content/config/transports/mkcp.md target=blank><i class="fab fa-github"></i></a></li><li><i class="fas fa-calendar"></i>23 December 2020</li></ul></nav></div></section></article><footer><footer><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/XTLS><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020-2021 ProjectX Community All Rights Reserved</small></div></div></div></footer></footer></body></html>