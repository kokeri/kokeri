<!doctype html><html><head><title>多文件配置 :: Project X</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2021-02-09T14:04:29 UTC"><meta name=description content="Project X 的文档."><meta name=author content="Project X"><title>多文件配置 :: Project X</title><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css><script src=https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js></script><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/layout.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.main.css><link rel=stylesheet type=text/css href=https://xtls.github.io/css/style.menu.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/notice.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/tabs.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/panel.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/columns.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/children.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/attachments.css><link rel=stylesheet type=text/css href=https://xtls.github.io/sass/shortcodes/alert.css><link rel=stylesheet type=text/css href=/css/docport.css><script src=/js/docport.js></script><script type=text/javascript>var baseurl="https:\/\/xtls.github.io";</script><link rel=stylesheet href=/css/custom.css></head><body data-url=/en/config/multiple_config/><style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style><header><div><div class=burger><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a></div><div><a class=baselink href=https://xtls.github.io>Project X</a></div><nav class=shortcuts><li role><a href=/about/new rel=noopener>What's New</a></li><li role><a href=https://github.com/XTLS rel=noopener>GitHub</a></li><li role><a href=https://github.com/XTLS/Xray-core/releases rel=noopener>Download</a></li><li role><a href=https://xtls.github.io/ rel=noopener>Documentation</a></li></nav></div></header><article><aside><div class=search><div class=searchbox><input data-search-input id=search-by type=text placeholder="Type to search..."></div><script type=text/javascript src=/vendor/lunr/lunr.min.js></script><script type=text/javascript src=/vendor/auto-complete/auto-complete.js></script><link href=/vendor/auto-complete/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https:\/\/xtls.github.io\/en";</script><script type=text/javascript src=/js/search.js></script></div><center><a class=github-button href=https://github.com/XTLS/Xray-core/releases data-icon=octicon-cloud-download aria-label="Download vjeantet/hugo-theme-docport on GitHub">Download</a>
<a class=github-button href=https://github.com/XTLS/Xray-core data-icon=octicon-star data-show-count=false aria-label="Star vjeantet/hugo-theme-docport on GitHub">Star</a>
<a class=github-button href=https://github.com/XTLS/Xray-core/fork data-icon=octicon-repo-forked data-show-count=true aria-label="Fork vjeantet/hugo-theme-docport on GitHub">Fork</a></center>
<script async defer src=https://buttons.github.io/buttons.js></script><div id=close_menu><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')"><i class="fa fa-lg fa-times"></i></a></div><ul class=menu><hr><li data-nav-id=https://xtls.github.io/en/about/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/en/about/>Project X&nbsp;⚡</a><ul><li data-nav-id=https://xtls.github.io/en/about/new/ class="dd-item
item_level_$level"><a href=/en/about/new/>X History&nbsp;</a></li></ul></li><hr><li data-nav-id=https://xtls.github.io/en/guide/ class="dd-item alwaysopen
item_level_$level"><a href=/en/guide/>Quick start&nbsp;</a></li><li data-nav-id=https://xtls.github.io/en/config/ class="dd-item parent haschildren
item_level_$level"><i class="fas fa-chevron-down ddexp"></i><a href=/en/config/>Configuration files&nbsp;📜</a><ul><li data-nav-id=https://xtls.github.io/en/config/base/ class="dd-item haschildren
item_level_$level"><a href=/en/config/base/>Basic configuration module&nbsp;</a>
<i class="fas fa-chevron-right ddexp"></i><ul><li data-nav-id=https://xtls.github.io/en/config/base/log/ class="dd-item
item_level_$level"><a href=/en/config/base/log/>日志配置</a></li><li data-nav-id=https://xtls.github.io/en/config/base/api/ class="dd-item
item_level_$level"><a href=/en/config/base/api/>API interfaces</a></li><li data-nav-id=https://xtls.github.io/en/config/base/dns/ class="dd-item
item_level_$level"><a href=/en/config/base/dns/>Built-in dns server</a></li><li data-nav-id=https://xtls.github.io/en/config/base/routing/ class="dd-item
item_level_$level"><a href=/en/config/base/routing/>Routing</a></li><li data-nav-id=https://xtls.github.io/en/config/base/policy/ class="dd-item
item_level_$level"><a href=/en/config/base/policy/>本地策略</a></li><li data-nav-id=https://xtls.github.io/en/config/base/inbounds/ class="dd-item
item_level_$level"><a href=/en/config/base/inbounds/>Inbounds</a></li><li data-nav-id=https://xtls.github.io/en/config/base/outbounds/ class="dd-item
item_level_$level"><a href=/en/config/base/outbounds/>Outbounds</a></li><li data-nav-id=https://xtls.github.io/en/config/base/transport/ class="dd-item
item_level_$level"><a href=/en/config/base/transport/>传输方式</a></li><li data-nav-id=https://xtls.github.io/en/config/base/stats/ class="dd-item
item_level_$level"><a href=/en/config/base/stats/>统计信息</a></li><li data-nav-id=https://xtls.github.io/en/config/base/reverse/ class="dd-item
item_level_$level"><a href=/en/config/base/reverse/>反向代理</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/config/inbound-protocols/ class="dd-item
item_level_$level"><a href=/en/config/inbound-protocols/>Inbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/en/config/outbound-protocols/ class="dd-item
item_level_$level"><a href=/en/config/outbound-protocols/>Outbounds 可用协议列表</a></li><li data-nav-id=https://xtls.github.io/en/config/transports/ class="dd-item
item_level_$level"><a href=/en/config/transports/>传输方式列表</a></li><li data-nav-id=https://xtls.github.io/en/config/fallback/ class="dd-item
item_level_$level"><a href=/en/config/fallback/>Fallbacks</a></li><li data-nav-id=https://xtls.github.io/en/config/xtls/ class="dd-item
item_level_$level"><a href=/en/config/xtls/>XTLS</a></li><li data-nav-id=https://xtls.github.io/en/config/env/ class="dd-item
item_level_$level"><a href=/en/config/env/>Environment Variables</a></li><li data-nav-id=https://xtls.github.io/en/config/multiple_config/ class="dd-item parent active alwaysopen
item_level_$level"><a href=/en/config/multiple_config/>多文件配置</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/documents/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/en/documents/>Using Experiences&nbsp;📚</a><ul><li data-nav-id=https://xtls.github.io/en/documents/level-0/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-0/>小小白白话文&nbsp;📙</a></li><li data-nav-id=https://xtls.github.io/en/documents/level-1/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-1/>Getting Started Skills&nbsp;</a></li><li data-nav-id=https://xtls.github.io/en/documents/level-2/ class="dd-item alwaysopen
item_level_$level"><a href=/en/documents/level-2/>Advanced Documentation&nbsp;📘</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/develop/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/en/develop/>开发指南&nbsp;🖥️</a><ul><li data-nav-id=https://xtls.github.io/en/develop/intro/ class="dd-item alwaysopen
item_level_$level"><a href=/en/develop/intro/>开发手册</a></li><li data-nav-id=https://xtls.github.io/en/develop/protocols/ class="dd-item alwaysopen
item_level_$level"><a href=/en/develop/protocols/>协议详解</a></li></ul></li><li data-nav-id=https://xtls.github.io/en/faq/ class="dd-item alwaysopen
item_level_$level"><a href=/en/faq/>常见问答&nbsp;💬</a></li><li data-nav-id=https://xtls.github.io/en/caseslip/ class="dd-item alwaysopen
item_level_$level"><a href=/en/caseslip/>大案牍术&nbsp;</a></li><hr><li data-nav-id=https://xtls.github.io/en/links/ class="dd-item alwaysopen
item_level_$level"><a href=/en/links/>常用链接&nbsp;🤝</a></li></ul></aside><section class=page><nav id=ariane aria-label=breadcrumb><ol class=ariane><li><a class=text-link href=https://xtls.github.io>Home</a></li><li><a class=text-link href=/en/config/>Configuration files</a></li><li class=active>多文件配置</li></ol></nav><h1>多文件配置</h1><div class=jump-to-section><span onclick="$h=$(this);$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><span class="fas fa-align-right"></span>Jump to Section
<i class="fas fa-chevron-right"></i></span><nav id=TableOfContents><ul><li><a href=#多文件启动>多文件启动</a></li><li><a href=#规则说明>规则说明</a><ul><li><a href=#普通对象>普通对象（<code>{}</code>）</a></li><li><a href=#数组>数组（<code>[]</code>）</a></li></ul></li><li><a href=#推荐的多文件列表>推荐的多文件列表</a></li></ul></nav></div><div class=content><p>Xray 程序支持使用多个配置文件。</p><p>多配置文件的主要作用在于分散不同作用模块配置，便于管理和维护。<br></p><p>该功能主要考虑是为了丰富 Xray 的生态链，比如对于 GUI 的客户端，一般只实现节点选择等固定的功能，对于太复杂的配置难以图形化实现；只需留一个 <code>confdir</code> 的自定义配置目录供配置复杂的功能；对于服务器的部署脚本，只需往 <code>confdir</code> 添加文件即可实现配置多种协议。</p><h2 ref=多文件启动>多文件启动</h2><a class=anchor id=多文件启动></a><hr><div class="notices info"><p><strong>TIP</strong><br>启动信息中会提示依次读入的每个配置文件，留意启动信息是否符合你预设的顺序。</p></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>$ xray run -confdir /etc/xray/confs
</code></pre></div><p>也可使用 <code>Xray.location.confdir</code> 或 <code>Xray_LOCATION_CONFDIR</code> 指定 <code>confdir</code>。</p><p>参数 <code>-confdir</code> 的作用优先于环境变量，如果参数指定了有效的目录则不再读取环境变量中的路径。</p><p><br></p><h2 ref=规则说明>规则说明</h2><a class=anchor id=规则说明></a><hr><h3 ref=普通对象>普通对象（<code>{}</code>）</h3><a class=anchor id=普通对象></a><hr><p><strong>在 json 的顶级对象当中，后者覆盖或补充前者。</strong></p><p>比如：</p><ul><li>base.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;log&#34;</span>: {},
    <span style=color:#f92672>&#34;api&#34;</span>: {},
    <span style=color:#f92672>&#34;dns&#34;</span>: {},
    <span style=color:#f92672>&#34;stats&#34;</span>: {},
    <span style=color:#f92672>&#34;policy&#34;</span>: {},
    <span style=color:#f92672>&#34;transport&#34;</span>: {},
    <span style=color:#f92672>&#34;routing&#34;</span>: {},
    <span style=color:#f92672>&#34;inbounds&#34;</span>: []
}
</code></pre></div><ul><li>outbounds.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;outbounds&#34;</span>: []
}
</code></pre></div><p>以多配置启动 Xray：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>$ xray run -confdir /etc/xray/confs
</code></pre></div><p>这两个配置文件的就等效于合成一起的整配置。当需要修改出口节点，只需要修改 <code>outbounds.json</code> 内容。</p><p>如果需要改编日志 log 的级别，也不需要改 <code>base.json</code>，只需后续增加一个配置：</p><ul><li>debuglog.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;log&#34;</span>: {
        <span style=color:#f92672>&#34;loglevel&#34;</span>: <span style=color:#e6db74>&#34;debug&#34;</span>
    }
}
</code></pre></div><p>启动顺序放置在 base 后，即可输出 debug 级别的日志</p><p><br></p><h3 ref=数组>数组（<code>[]</code>）</h3><a class=anchor id=数组></a><hr><p>在 json 配置中的<code>inbounds</code>和<code>outbounds</code>是数组结构，他们有特殊的规则：</p><ul><li>当配置中的数组元素有 2 或以上，覆盖前者的 inbounds/oubounds；</li><li>当配置中的数组元素只有 1 个时，查找原有<code>tag</code>相同的元素进行覆盖；若无法找到：<ul><li>对于 inbounds，添加至最后（inbounds 内元素顺序无关）</li><li>对于 outbounds，添加至最前（outbounds 默认首选出口）；但如果文件名含有 tail（大小写均可），添加至最后。</li></ul></li></ul><p>借助多配置，可以很方便为原有的配置添加不同协议的 inbound，而不必修改原有配置。</p><p>以下例子不是有效配置，只为展示上述规则。</p><ul><li>000.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;inbounds&#34;</span>: [
        {
            <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;tag&#34;</span>:<span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>1234</span>
        }
    ]
}
</code></pre></div><ul><li>001.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;inbounds&#34;</span>: [
        {
            <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;http&#34;</span>,
            <span style=color:#f92672>&#34;tag&#34;</span>:<span style=color:#e6db74>&#34;http&#34;</span>
        }
    ]
}
</code></pre></div><ul><li>002.json</li></ul><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;inbounds&#34;</span>: [
        {
            <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;tag&#34;</span>:<span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>4321</span>
        }
    ]
}
</code></pre></div><p>三个配置将会合成为：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-json data-lang=json>{
    <span style=color:#f92672>&#34;inbounds&#34;</span>: [
        {
            <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;tag&#34;</span>:<span style=color:#e6db74>&#34;socks&#34;</span>,
            <span style=color:#f92672>&#34;port&#34;</span>: <span style=color:#ae81ff>4321</span> <span style=color:#960050;background-color:#1e0010>//</span> <span style=color:#960050;background-color:#1e0010>&lt;---</span> <span style=color:#ae81ff>002</span><span style=color:#960050;background-color:#1e0010>顺序在</span><span style=color:#ae81ff>000</span><span style=color:#960050;background-color:#1e0010>后，因此覆盖tag为socks的inbound端口为</span><span style=color:#ae81ff>4321</span>
        },
        {
            <span style=color:#f92672>&#34;protocol&#34;</span>: <span style=color:#e6db74>&#34;http&#34;</span>,
            <span style=color:#f92672>&#34;tag&#34;</span>:<span style=color:#e6db74>&#34;http&#34;</span>
        }
    ]
}
</code></pre></div><p><br></p><h2 ref=推荐的多文件列表>推荐的多文件列表</h2><a class=anchor id=推荐的多文件列表></a><hr><p>执行：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#66d9ef>for</span> BASE in 00_log 01_api 02_dns 03_routing 04_policy 05_inbounds 06_outbounds 07_transport 08_stats 09_reverse; <span style=color:#66d9ef>do</span> echo <span style=color:#e6db74>&#39;{}&#39;</span> &gt; <span style=color:#e6db74>&#34;/etc/Xray/</span>$BASE<span style=color:#e6db74>.json&#34;</span>; <span style=color:#66d9ef>done</span>
</code></pre></div><p>或</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#66d9ef>for</span> BASE in 00_log 01_api 02_dns 03_routing 04_policy 05_inbounds 06_outbounds 07_transport 08_stats 09_reverse; <span style=color:#66d9ef>do</span> echo <span style=color:#e6db74>&#39;{}&#39;</span> &gt; <span style=color:#e6db74>&#34;/usr/local/etc/Xray/</span>$BASE<span style=color:#e6db74>.json&#34;</span>; <span style=color:#66d9ef>done</span>
</code></pre></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>.
├── 00_log.json
├── 01_api.json
├── 02_dns.json
├── 03_routing.json
├── 04_policy.json
├── 05_inbounds.json
├── 06_outbounds.json
├── 07_transport.json
├── 08_stats.json
└── 09_reverse.json

<span style=color:#ae81ff>0</span> directories, <span style=color:#ae81ff>10</span> files
</code></pre></div></div><div class=chevrons></div></section><section class=right-menu><div class=TableOfContents><label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label><nav><ul><li><a href=/en/config/multiple_config/>多文件配置</a></li></ul></nav><nav id=TableOfContents><ul><li><a href=#多文件启动>多文件启动</a></li><li><a href=#规则说明>规则说明</a><ul><li><a href=#普通对象>普通对象（<code>{}</code>）</a></li><li><a href=#数组>数组（<code>[]</code>）</a></li></ul></li><li><a href=#推荐的多文件列表>推荐的多文件列表</a></li></ul></nav></div><div class=Actions><nav><ul><li><a href=https://github.com/XTLS/XTLS.github.io/tree/main/content/config/multiple_config/_index.md target=blank><i class="fab fa-github"></i>Improve this page</a></li><li><i class="fas fa-calendar"></i>Last update on 23 December 2020</li></ul></nav></div></section></article><footer><footer><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/stack><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel="noopener noreferrer" href=https://github.com/XTLS><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel="noopener noreferrer" href=https://example.org/mail><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2020-2021 ProjectX Community All Rights Reserved</small></div></div></div></footer></footer></body></html>